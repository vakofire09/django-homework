{% extends "store/base.html" %}
{% block title %}{{ category.name }} - My Shop{% endblock %}

{% block content %}
<div class="container py-5">
  <h2 class="mb-5 text-center fw-bold text-light">
    üõçÔ∏è Products in "<span class="text-warning">{{ category.name }}</span>"
  </h2>

  {% if products %}
  <div class="row">
    {% for product in products %}
      <div class="col-md-3 mb-4 d-flex align-items-stretch">
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden product-card h-100" style="background-color: #1e1e1f;">
          {% if product.image %}
            <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}" style="object-fit: cover; height: 250px;">
          {% else %}
            <div class="card-img-top bg-dark text-light d-flex align-items-center justify-content-center" style="height: 250px;">
              No Image
            </div>
          {% endif %}

          <div class="card-body text-light d-flex flex-column">
            <h5 class="card-title fw-bold text-light text-center">{{ product.name }}</h5>

            <!-- Rating -->
            <div class="text-center mb-2">
              {% with rating=product.rating|floatformat:0 %}
                {% for i in "12345" %}
                  {% if i|stringformat:"i" <= rating %}
                    <span class="text-warning">&#9733;</span>
                  {% else %}
                    <span class="text-secondary">&#9733;</span>
                  {% endif %}
                {% endfor %}
              {% endwith %}
              <small>({{ product.rating|floatformat:1 }}/5)</small>
            </div>

            <!-- Price -->
            <p class="card-text text-center mt-auto fs-5 fw-semibold text-white">${{ product.price }}</p>

            <!-- Badges -->
            <div class="text-center mb-3">
              {% if product.discount %}
                <span class="badge bg-success px-3 py-2">Discount</span>
              {% endif %}
              {% if not product.in_stock %}
                <span class="badge bg-danger px-3 py-2">Out of stock</span>
              {% endif %}
            </div>

            <!-- Buttons -->
            <div class="d-flex justify-content-between">
              <a href="{% url 'product_detail' product.pk %}" class="btn btn-outline-light flex-grow-1 me-2 fw-bold hover-glow">
                View
              </a>
              <form action="{% url 'add_to_cart' product.pk %}" method="post" class="m-0 flex-grow-1">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-success w-100 fw-bold hover-glow">
                  <i class="bi bi-cart-plus"></i> Add
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="alert alert-info text-center fs-5 mt-5">No products in this category yet.</div>
  {% endif %}

  <div class="text-center mt-5">
    <a href="{% url 'home' %}" class="btn btn-outline-light px-4 py-2 fw-bold hover-glow">
      ‚Üê Back to Home
    </a>
  </div>
</div>

<style>
  .product-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 25px rgba(255, 255, 255, 0.1);
  }

  .hover-glow:hover {
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  }

  .badge {
    font-size: 0.85rem;
  }

  h2 {
    letter-spacing: 1px;
  }
</style>
{% endblock %}